

%************************************************************************************************************************************************************
%Will Sample a mean value for each state based upon the observations assigned to that state
%A sigma will be directly Calculated and used to sample mean
%TODO: SAMPLE SIGMA?
%************************************************************************************************************************************************************


%************************************************************************************************************************************************************
%Argmuments:
%fretdata : vector of all observations, including delimiter values (see initialize)
%statedata: vector of all assigned states, including delimiter values (see initialize) 
%************************************************************************************************************************************************************



function [newmu, newsigma] = samplemusigma(fretdata, statedata,numstates)


%************************************************************************************************************************************************************
% WILL SAMPLE THE MAXIMUM LIKELYHOOD VALUE FROM FRET VALUES ASSIGNED TO GIVEN MU/SIGMA 
%************************************************************************************************************************************************************


%************************************************************************************************************************************************************
% newmu: vector of mu values for each state
% newsigma: vector of sigma valuse for each state 
%************************************************************************************************************************************************************

 
 
  newmu = zeros(1,numstates);
  newsigma = zeros(1,numstates); 



%************************************************************************************************************************************************************
% For each state 
% We take the mean of all observations in that state
% The Sigma is directly calculated
% The mean is sampled from actualmean+rand(0 excl - 1 incl)*(standarddev of state/sqrt(number of observations in that state))  
%************************************************************************************************************************************************************

 

	for i = 1:numstates,  


%***********************************************************************************************************************************************************
% If the state is not empty, We find the indices of observed  values for given state. And their corresponding observation values 
%************************************************************************************************************************************************************
	
	
		indices = find(statedata == i);

		if ~isempty(indices)

			values = fretdata(indices); 

%************************************************************************************************************************************************************
%DIRECTLY CALCULATE MEAN FROM STATE VALUES
%************************************************************************************************************************************************************

       			newmu(i) = mean(values); %we assign mu for state i as the mean of all FRETS taken to be in that state
       
%************************************************************************************************************************************************************
%DIRECTLY CALCULATE SIGMA FROM STATE VALUES
%************************************************************************************************************************************************************

			newsigma(i) = std(values); %we assign sigma for state i as the standard deviation of all FRETS taken to be in that state.  
       
%************************************************************************************************************************************************************
%CALCULATE SIGMA TO SAMPLE MU FROM A NORMAL DISTRIBUTION
%************************************************************************************************************************************************************

			samplesigma = newsigma(i)/sqrt(size(values,2)); 
       
%************************************************************************************************************************************************************
%SAMPLE MEAN FROM A NORMAL DISTRIBUTION WITH MAXIMUM LIKELYHOOD VALUE
%************************************************************************************************************************************************************


			newmu(i)=newmu(i)+(samplesigma*randn()); 
  

%************************************************************************************************************************************************************
%If the state is empty, draw a random mean and sigma
%************************************************************************************************************************************************************

  		else

			newmu(i) = rand(); 
			newsigma(i) = rand()*.1; 
		end
	end  
